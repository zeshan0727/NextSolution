name: Generate Pages
on: workflow_dispatch
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Generate Pages
        run: |
          # Create simple generator
          cat > gen.js << 'EOF'
          const fs = require('fs');
          const content = fs.readFileSync('movies.html', 'utf8');
          
          // Extract movies array
          const start = content.indexOf('const movies = [');
          const end = content.indexOf('];', start);
          const arrStr = content.substring(start + 'const movies = '.length, end + 1);
          
          try {
            const movies = eval(arrStr);
            console.log(`Found ${movies.length} movies`);
            
            // Generate pages
            movies.forEach((movie, i) => {
              const slug = movie.title.toLowerCase().replace(/[^a-z0-9]/g, '-').replace(/-+/g, '-');
              const html = `<html><head><title>${movie.title}</title></head><body><h1>${movie.title}</h1><a href="${movie.link}">Watch</a><br><a href="movies.html">Back</a></body></html>`;
              fs.writeFileSync(`${slug}.html`, html);
              
              if ((i + 1) % 100 === 0) console.log(`Generated ${i + 1} pages`);
            });
            
            console.log(`Done! Generated ${movies.length} pages`);
          } catch (e) {
            console.error('Error:', e.message);
          }
          EOF
          
          node gen.js
          
          # Count results
          echo "Generated files:"
          ls *.html | wc -l
